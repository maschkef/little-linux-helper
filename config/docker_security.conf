# little-linux-helper/config/docker_security.conf
# Copyright (c) 2025 wuldorf
# SPDX-License-Identifier: MIT
#
# This file is part of the 'little-linux-helper' collection.
# Licensed under the MIT License. See the LICENSE file in the project root for more information.
#
# Little Linux Helper - Docker Security Konfiguration

# CFG_LH_DOCKER_COMPOSE_ROOT:
# Der absolute Pfad zum Wurzelverzeichnis, in dem Docker-Compose Projekte gesucht werden sollen.
# Wird nur verwendet wenn CFG_LH_DOCKER_CHECK_MODE="all" ist.
CFG_LH_DOCKER_COMPOSE_ROOT="/opt/containers" # Anmerkung: Aufbau der docker bei mir ist meist in der art nach den Anleitungen auf goneuland.de erstellt, daher dieser Ordner.

# CFG_LH_DOCKER_CHECK_MODE:
# Bestimmt welche Docker-Compose Dateien geprüft werden sollen.
# Verfügbare Optionen:
# - running: Nur Docker-Compose Dateien von aktuell laufenden Containern prüfen (Standard, empfohlen)
# - all:     Alle Docker-Compose Dateien im konfigurierten Verzeichnis prüfen
CFG_LH_DOCKER_CHECK_MODE="running"

# CFG_LH_DOCKER_SKIP_WARNINGS:
# Komma-getrennte Liste von Warnungen die übersprungen werden sollen
# Verfügbare Optionen:
# - update-labels: Überspringt Prüfung auf Diun/Watchtower Labels
# - env-permissions: Überspringt .env Dateiberechtigungen
# - dir-permissions: Überspringt Verzeichnisberechtigungen  
# - latest-images: Überspringt Latest-Image Warnungen
# - privileged: Überspringt privileged Container Warnungen
# - host-volumes: Überspringt Host-Volume Mount Hinweise
# - exposed-ports: Überspringt exponierte Port Warnungen
# - capabilities: Überspringt gefährliche Capabilities Warnungen
# - security-opt: Überspringt Security-Opt Deaktivierung Warnungen
# - default-passwords: Überspringt Standard-Passwort Prüfung
# - sensitive-data: Überspringt sensitive Daten Prüfung
CFG_LH_DOCKER_SKIP_WARNINGS="latest-images"

# CFG_LH_DOCKER_CHECK_RUNNING:
# Soll eine Übersicht der laufenden Container angezeigt werden? (true/false)
# Bei 'true' wird 'docker ps' ausgeführt um laufende Container in der Zusammenfassung anzuzeigen
CFG_LH_DOCKER_CHECK_RUNNING="false"

# CFG_LH_DOCKER_DEFAULT_PATTERNS:
# Komma-getrennte Liste von Regex-Patterns für unsichere Default-Werte
# Diese Patterns werden in Docker-Compose Dateien gesucht
# Format: VARIABLE=regex_fuer_wert,ANDERE_VAR=anderes_regex
# Das Skript muss den Teil nach dem '=' als regulären Ausdruck interpretieren.
# Beispiele für Regex-Muster:
#   ^$                                      - Leerer String
#   ^(password|admin|root)$                 - Einer der Werte "password", "admin", "root" (Groß-/Kleinschreibung beachten)
#   ^(?i)(password|admin|root)$             - Wie oben, aber Case-Insensitive (wenn von der Regex-Engine unterstützt)
#   ^(test|example|dummy|changeme|passwort)$ - Typische Platzhalter oder schwache Passwörter.
#
# Das folgende umfassende Regex-Muster wird für die meisten Passwort- und Schlüsselvariablen verwendet.
# Es erkennt leere Werte und eine breite Palette gängiger unsicherer Passwörter/Schlüssel (case-insensitive).
COMMON_WEAK_PASSWORD_REGEX="^(|(?i)(password|passwort|secret|geheim|admin|root|123456|12345678|qwerty|asdfgh|test|example|dummy|changeme|changeit|default|standard|pass|pwd|key|token|secretkey|apikey|mysql|postgres|mongo|redis|guest|mariadb|p[a@]\$\$w[o0]rd|r[o0]{2}t|adm[i1]n|geheim123|masterkey|masterpassword|yourpassword|your_password|temp|tmp|toor|rootpass|adminpass|user|username|login|access|secret_token|api_token|private_key|privatekey))$"
COMMON_PLACEHOLDER_KEY_REGEX="^(|(?i)(test|example|dummy|changeme|placeholder|your_api_key|your_secret_key|your_token|temp_key|temp_secret|temp_token|AKIAIOSFODNN7EXAMPLE|some[Rr]andom[Ss]tring|base64:.*))$"

CFG_LH_DOCKER_DEFAULT_PATTERNS="PASSWORD=${COMMON_WEAK_PASSWORD_REGEX},"\
"MYSQL_ROOT_PASSWORD=${COMMON_WEAK_PASSWORD_REGEX},"\
"MYSQL_PASSWORD=${COMMON_WEAK_PASSWORD_REGEX},"\
"POSTGRES_PASSWORD=${COMMON_WEAK_PASSWORD_REGEX},"\
"ADMIN_PASSWORD=${COMMON_WEAK_PASSWORD_REGEX},"\
"REDIS_PASSWORD=${COMMON_WEAK_PASSWORD_REGEX},"\
"MONGO_INITDB_ROOT_PASSWORD=${COMMON_WEAK_PASSWORD_REGEX},"\
"RABBITMQ_DEFAULT_PASS=${COMMON_WEAK_PASSWORD_REGEX},"\
"ELASTIC_PASSWORD=${COMMON_WEAK_PASSWORD_REGEX},"\
"GF_SECURITY_ADMIN_PASSWORD=${COMMON_WEAK_PASSWORD_REGEX},"\
"KEYCLOAK_ADMIN_PASSWORD=${COMMON_WEAK_PASSWORD_REGEX},"\
"API_KEY=${COMMON_PLACEHOLDER_KEY_REGEX},"\
"SECRET_KEY=${COMMON_PLACEHOLDER_KEY_REGEX},"\
"TOKEN=${COMMON_PLACEHOLDER_KEY_REGEX},"\
"APP_KEY=${COMMON_PLACEHOLDER_KEY_REGEX}"


# CFG_LH_DOCKER_EXCLUDE_DIRS:
# Komma-getrennte Liste von Verzeichnisnamen (nicht Pfaden), die bei der Suche nach
# Docker-Compose Dateien übersprungen werden sollen. Diese Namen werden relativ
# zu jedem durchsuchten Verzeichnis geprüft.
# Wird nur verwendet wenn CFG_LH_DOCKER_CHECK_MODE="all" ist.
CFG_LH_DOCKER_EXCLUDE_DIRS="docker,.docker_archive,node_modules,.git,.cache,venv,__pycache__" # Anmerkung: "docker" und ".docker_archive" sind nur spezifisch in meiner Umgebung relevant

# CFG_LH_DOCKER_SEARCH_DEPTH:
# Maximale Tiefe für die Suche nach Docker-Compose Dateien.
# Standardwert ist 3, falls nicht in der Konfiguration gesetzt.
# Wird nur verwendet wenn CFG_LH_DOCKER_CHECK_MODE="all" ist.
CFG_LH_DOCKER_SEARCH_DEPTH="3"

# Beispiel für erweiterte Konfiguration:
# CFG_LH_DOCKER_CHECK_MODE="all"
# CFG_LH_DOCKER_SKIP_WARNINGS="latest-images,host-volumes"
# CFG_LH_DOCKER_CHECK_RUNNING="false"
# CFG_LH_DOCKER_DEFAULT_PATTERNS="API_KEY=test,SECRET=secret,TOKEN=token"